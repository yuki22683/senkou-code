/**
 * lineHintsの追加修正（v2）
 */

import fs from 'fs';
import path from 'path';

const dir = 'data/lessons';

// 追加の置換ルール
const replacementRules = [
  // 空白から始まる不完全な置換を修正
  [/" を入力します。"/g, 'null'],
  [/"、保存用のリダイレクト > を入力します。"/g, '"ファイルへの出力を指定するリダイレクト演算子です。"'],
  [/" と入力します。"/g, 'null'],

  // if文関連
  [/"if文を閉じる fi キーワードを入力します。"/g, '"if文の終了を示すキーワードです。"'],
  [/"ループを終了する done キーワードを入力します。"/g, '"ループの終了を示すキーワードです。"'],
  [/"case文を終了する esac キーワードを入力します。"/g, '"case文の終了を示すキーワードです。"'],

  // bash変数関連
  [/"変数名 nums と最初の要素 10 を入力します。"/g, '"配列名と最初の要素の数値を設定します。"'],
  [/"変数名 i と初期値 1 を入力します。"/g, '"カウンタ変数と初期値を設定します。"'],
  [/"while キーワードと変数 \$i を入力します。"/g, '"繰り返し条件を指定するキーワードと変数です。"'],
  [/"echo コマンドと変数 \$i を入力します。"/g, '"現在のカウンタ値を出力します。"'],
  [/"関数名 add と引数 3 , 5 を入力します。"/g, '"定義した関数を引数付きで呼び出します。"'],
  [/"変数名 word と文字列 \\"Bash\\" を入力します。"/g, '"文字列を格納する変数名と値を設定します。"'],
  [/"変数名 text と文字列 \\"Hello World\\" を入力します。"/g, '"部分取得する文字列を変数に設定します。"'],
  [/"変数名 fruit と文字列 \\"りんご\\" を入力します。"/g, '"分岐判定する変数と値を設定します。"'],
  [/"echo コマンドと文字列 \\"赤\\" を入力します。"/g, '"りんごに対応する色を出力します。"'],
  [/"パターン \\"バナナ\\"、echo コマンド、文字列 \\"黄色\\" を入力します。"/g, '"バナナに対応する色を出力する分岐です。"'],
  [/"変数名 files 、echo コマンド、文字列 \\"テスト\\" を入力します。"/g, '"コマンド置換で変数に文字列を格納します。"'],
  [/"echo コマンドと文字列 \\"すごい\\" を入力します。"/g, '"条件が真のときに出力するメッセージです。"'],
  [/"配列名 names と要素 \\"アリス\\" \\"ボブ\\" を入力します。"/g, '"配列名と複数の要素を定義します。"'],
  [/"echo コマンドと文字列 \\"こんにちは\\" を入力します。"/g, '"関数の処理として出力するメッセージです。"'],
  [/"ls コマンド、エラー出力リダイレクト 2 、成功時の && 、echo コマンド、失敗時の \|\| 、echo コマンド、文字列 \\"エラー\\" を入力します。"/g, '"ファイル確認と成功/失敗時の処理を記述します。"'],
  [/"echo コマンドと文字列 \\"存在します\\" を入力します。"/g, '"ファイルが存在する場合に出力するメッセージです。"'],
  [/"echo コマンド、文字列 \\"りんご\\"、パイプ \| 、sed コマンド、置換前の \\"りんご\\"、置換後の \\"バナナ\\" を入力します。"/g, '"文字列置換のパイプライン処理を記述します。"'],

  // Go
  [/"範囲をあらわす `range` を入力しましょう。"/g, '"配列やスライスを反復処理するキーワードです。"'],

  // JavaScript
  [/"\{ name: 'たろう' \} と入力しましょう。"/g, '"nameプロパティを持つオブジェクトリテラルです。"'],

  // Perl
  [/"サブルーチンを定義するキーワードを入力しましょう。"/g, '"関数（サブルーチン）を定義するキーワードです。"'],

  // Python
  [/"条件を満たしたときの print 関数を入力します。"/g, '"条件が真のときにメッセージを出力する関数です。"'],
  [/"メッセージを表示する print 関数を入力します。"/g, '"メッセージを画面に出力する関数です。"'],
  [/"代入する文字列 'Python' を入力します。"/g, '"変数に代入する文字列の値です。"'],
  [/"内包表記で使用する for キーワードを入力します。"/g, '"リスト内包表記で繰り返しを行うキーワードです。"'],
  [/"結果のリストを表示する print 関数を入力します。"/g, '"処理結果を画面に出力する関数です。"'],
  [/"エラー監視を開始する try キーワードを入力します。"/g, '"例外が発生する可能性のあるコードを囲むキーワードです。"'],
  [/"鳴き声を表示する print 関数を入力します。"/g, '"メソッドの処理として出力する関数です。"'],
  [/"結果を表示するための print 関数を入力します。"/g, '"計算結果を画面に出力する関数です。"'],
  [/"結果を表示する print 関数を入力します。"/g, '"処理結果を画面に出力する関数です。"'],
  [/"メッセージを出す print 関数を入力します。"/g, '"メッセージを画面に出力する関数です。"'],
  [/"内容を表示する print 関数を入力します。"/g, '"読み込んだ内容を画面に出力する関数です。"'],
  [/"不足している単語 'world' を入力します。"/g, '"文字列に追加する単語です。"'],

  // SQL
  [/"「両方とも」という意味のキーワードを入力しましょう。"/g, '"複数の条件を両方満たす場合を指定するキーワードです。"'],
  [/"NULLかどうかをチェックするキーワードを入力しましょう。"/g, '"値がNULLかどうかを判定するキーワードです。"'],

  // 不完全な置換結果を修正
  [/"メッセージを表示する 文字列を画面に出力するコマンドです。"/g, '"文字列を画面に出力するコマンドです。"'],
  [/"echo コマンドと展開するfilesという名前で変数を宣言します。"/g, '"変数の内容を文字列に埋め込んで出力します。"'],
  [/"echo コマンド、read コマンド、変数名 val を2回、最後は 文字列を画面に出力するコマンドです。"/g, '"入力を受け取り、その内容を表示する一連のコマンドです。"'],
];

const files = fs.readdirSync(dir).filter(f => f.endsWith('.ts') && f !== 'index.ts');
let totalFixed = 0;

files.forEach(file => {
  const filePath = path.join(dir, file);
  let content = fs.readFileSync(filePath, 'utf8');
  let originalContent = content;
  let fileFixed = 0;

  replacementRules.forEach(([pattern, replacement]) => {
    const matches = content.match(pattern);
    if (matches) {
      fileFixed += matches.length;
      content = content.replace(pattern, replacement);
    }
  });

  if (content !== originalContent) {
    fs.writeFileSync(filePath, content);
    console.log(`${file}: ${fileFixed}件修正`);
    totalFixed += fileFixed;
  }
});

console.log(`\n合計: ${totalFixed}件修正`);
